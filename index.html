<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>CROnation — One World. One CROnation.</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <style>
    :root{
      /* Neutral, professional palette */
      --bg: #ffffff;
      --text: #0f172a;           /* slate-900 */
      --muted: #475569;          /* slate-600 */
      --line: #e2e8f0;           /* slate-200 */
      --soft: #f8fafc;           /* slate-50 */
      --accent: #2563eb;         /* clean blue */
      --accent-600:#1d4ed8;
      --success:#16a34a;
      --warning:#d97706;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b0d12;
        --text:#e5e7eb;
        --muted:#9ca3af;
        --line:#1f2937;
        --soft:#0f1219;
        --accent:#3b82f6;
        --accent-600:#2563eb;
      }
      .card{ box-shadow: none; }
    }
    *{ box-sizing:border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
      color: var(--text);
      background: var(--bg);
      line-height: 1.5;
    }

    /* iOS notch + sticky header comfort */
header { padding-top: calc(env(safe-area-inset-top, 0px)); }

/* Let native anchor jumps account for the sticky header */
html { scroll-padding-top: 72px; }

/* Safer map height on mobile (no 100vh bugs) */
#map { height: clamp(280px, 58vh, 560px); }

/* Better hit targets on mobile */
.btn { min-height: 44px; }
.nav a.link { padding: 10px 6px; }

/* Keep Leaflet controls clear on small screens */
.leaflet-control-zoom { margin: 10px; }
.leaflet-control-zoom a { width: 34px; height: 34px; line-height: 34px; }

/* Sections won’t hide under the sticky header when linked */
#map-section, #leaderboard-card, #about { scroll-margin-top: 84px; }

/* Subtle mobile refinement */
* { -webkit-tap-highlight-color: transparent; }

    /* Layout */
    .container{
      width: min(1120px, 92vw);
      margin-inline:auto;
      padding: 24px 0 72px;
    }

    header{
      position: sticky;
      top:0;
      backdrop-filter: saturate(120%) blur(8px);
      background: color-mix(in srgb, var(--bg) 86%, transparent);
      border-bottom: 1px solid var(--line);
      z-index: 10;
    }
    .nav{
      width: min(1120px, 92vw);
      margin-inline:auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding: 14px 0;
    }
    .brand{
      display:flex; align-items:center; gap:10px; text-decoration:none; color:inherit;
    }
    .brand svg{ width:28px; height:28px; }
    .brand b{ font-weight:700; letter-spacing:0.2px; }
    .nav a.link{
      text-decoration:none; color: var(--muted); font-weight:500; margin: 0 10px;
    }
    .actions{ display:flex; align-items:center; gap:10px; }
    .btn{
      appearance:none; border:1px solid var(--line); background: var(--bg); color: var(--text);
      padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn.primary{ background: var(--accent); border-color: var(--accent); color: #fff; }
    .btn.primary:hover{ background: var(--accent-600); }
    .btn.ghost{ background: transparent; }

    /* Hero */
    .hero{
      padding: 48px 0 16px;
      display:grid; gap:16px; align-items:center; text-align:center;
    }
    .hero h1{
      margin:0;
      font-size: clamp(28px, 3.2vw + 12px, 48px);
      letter-spacing: -0.02em;
    }
    .hero p.lead{
      margin: 6px auto 0;
      color: var(--muted);
      max-width: 740px;
      font-size: clamp(15px, 1.2vw + 10px, 18px);
    }
    .hero .cta{
      margin-top: 18px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;
    }

    /* Stats */
    .stats{
      margin-top: 28px;
      display:grid; grid-template-columns: repeat(3, 1fr); gap:14px;
    }
    .stat{
      padding:14px 16px; border:1px solid var(--line); border-radius:12px; background: var(--soft);
      display:flex; align-items:center; justify-content:center; gap:10px; font-weight:600;
    }
    .stat small{ color:var(--muted); display:block; font-weight:500; }

    /* Content grid */
    .grid{
      margin-top: 36px;
      display:grid; gap:24px;
      grid-template-columns: 1.3fr 1fr;
    }
    @media (max-width: 960px){
      .grid{ grid-template-columns: 1fr; }
    }
    .card{
      border:1px solid var(--line); border-radius:14px; background: var(--bg);
      box-shadow: 0 2px 16px rgba(0,0,0,.04);
    }
    .card h3{ margin: 0 0 6px; font-size: 18px; }
    .card .body{ padding: 16px; }
    .muted{ color:var(--muted); }

    /* Map */
    #map{
  width:100%;
  height: clamp(280px, 58vh, 560px);
  border-radius: 12px; overflow:hidden; border:1px solid var(--line);
  background: var(--soft);
}
    
    .leaflet-container{ font: inherit; }
    .map-note{ margin-top:10px; color:var(--muted); font-size: 14px; }

    /* Leaderboard */
    table{ width:100%; border-collapse: collapse; }
    th, td{ text-align:left; padding:10px 12px; border-bottom: 1px solid var(--line); }
    th{ color:var(--muted); font-weight:600; font-size:14px; }
    td{ font-weight:600; }
    .rank{ width:56px; color:var(--muted); font-weight:600; }
    .country-name{ font-weight:600; }
    .count{ text-align:right; }

    /* Modal */
    .modal{
      position: fixed; inset:0;
      background: color-mix(in srgb, var(--bg) 40%, rgba(0,0,0,.55));
      display:none; align-items:center; justify-content:center; padding:20px;
      z-index:100;
    }
    .modal[open]{ display:flex; }
    .modal .panel{
      width: min(560px, 96vw);
      background: var(--bg); border:1px solid var(--line); border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0,0,0,.18);
      overflow:hidden;
    }
    .panel .header{
      padding: 14px 16px; border-bottom:1px solid var(--line); display:flex; justify-content:space-between; align-items:center;
    }
    .panel .content{ padding: 16px; display:grid; gap:16px; }
    .panel .footer{ padding: 16px; border-top:1px solid var(--line); display:flex; justify-content:flex-end; gap:10px; }

    .field{ display:grid; gap:6px; }
    label{ font-weight:600; }
    input, select{
      width:100%; padding:10px 12px; border:1px solid var(--line); border-radius:10px; background: var(--soft);
      font: inherit; color: var(--text);
    }

    /* Passport preview */
    .passport{
      border:1px dashed var(--line); border-radius:12px; padding:12px;
      display:grid; grid-template-columns: 72px 1fr; gap:12px; align-items:center;
      background: var(--soft);
    }
    .passport .emblem {
  display:grid;
  place-items:center;
  width:64px;
  height:64px;
  border-radius:12px;
  overflow:hidden;
  background: var(--soft);
}
.passport .emblem img {
  width:100%;
  height:100%;
  object-fit:contain;
}
    .passport .info b{ display:block; font-size:16px; }
    .passport .info small{ color:var(--muted); }

    .footer{
      margin-top: 48px; padding: 32px 0; border-top: 1px solid var(--line); color: var(--muted); font-size: 14px;
    }

    .visually-hidden{
      position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px);
      white-space:nowrap; border:0; padding:0; margin:-1px;
    }

    /* Motion accessibility */
    @media (prefers-reduced-motion: reduce){
      *{ transition: none !important; animation: none !important; }
    }

    /* --- Hamburger menu --- */
.nav{ position:relative; }
.links{ display:flex; gap:16px; }
.hamburger{
  display:none; margin-left:8px;
  width:40px; height:40px; border:1px solid var(--line); border-radius:10px;
  background: var(--soft); cursor:pointer;
  align-items:center; justify-content:center; gap:4px;
}
.hamburger span{
  display:block; width:18px; height:2px; background: var(--text); border-radius:2px;
}

/* Mobile dropdown */
.mobile-menu{
  display:none;
  position:fixed; left:0; right:0; top:64px; /* below header */
  background:var(--bg); border-top:1px solid var(--line); border-bottom:1px solid var(--line);
  padding:10px 12px; z-index: 9;
}
.mobile-menu a.link{ display:block; padding:12px; color:var(--text); text-decoration:none; }
.mobile-menu a.link + a.link{ border-top:1px solid var(--line); }

/* Show hamburger and collapse links on small screens */
@media (max-width: 640px){
  .links{ display:none; }
  .hamburger{ display:inline-flex; }
  .actions{ margin-left:auto; gap:8px; }
  .actions .btn{ padding:10px 12px; }
}
/* Hide mobile menu on desktop no matter what */
@media (min-width: 641px){
  .mobile-menu{ display:none !important; }
}

/* When menu is open */
.mobile-menu.open{ display:block; }
.hamburger[aria-expanded="true"] span:nth-child(2){ opacity:0; }
.hamburger[aria-expanded="true"] span:nth-child(1){ transform: translateY(6px) rotate(45deg); }
.hamburger[aria-expanded="true"] span:nth-child(3){ transform: translateY(-6px) rotate(-45deg); }
  </style>
</head>
<body>
  <header>
    <nav class="nav" aria-label="Primary">
  <a class="brand" href="#top" aria-label="CROnation home">
  <img src="https://raw.githubusercontent.com/LandoCrissian/WorldCoin/refs/heads/main/8DAEE2BE-F14F-4EB2-A993-E8EFE1EC2E35.png" 
       alt="CROnation logo" style="width:32px;height:32px;border-radius:50%;" />
  <b>CROnation</b>
</a>

  <!-- Desktop links -->
  <div class="links">
    <a class="link" href="#map-section">Map</a>
    <a class="link" href="#leaderboard-card">Leaderboard</a>
    <a class="link" href="#about">About</a>
  </div>

  <div class="actions">
    <button class="btn ghost" aria-disabled="true" title="Wallet connect coming soon">Connect Wallet</button>
    <button class="btn primary" onclick="scrollToMap()">Mark Your Country</button>
  </div>

  <!-- Mobile hamburger -->
  <button class="hamburger" id="hamburger"
          aria-label="Menu" aria-controls="mobile-menu" aria-expanded="false">
    <span></span><span></span><span></span>
  </button>

  <!-- Mobile dropdown menu -->
  <div class="mobile-menu" id="mobile-menu" role="menu">
    <a class="link" role="menuitem" href="#map-section">Map</a>
    <a class="link" role="menuitem" href="#leaderboard-card">Leaderboard</a>
    <a class="link" role="menuitem" href="#about">About</a>
  </div>
</nav>
  </header>

  <main id="top">
    <section class="container hero">
      <h1>One World. One CROnation.</h1>
      <p class="lead">A clean, global map of our community on Cronos. Mark your country, mint a simple passport NFT, and watch the world light up.</p>
      <div class="cta">
        <button class="btn primary" onclick="scrollToMap()">Mark Your Country</button>
        <a href="#" class="btn" title="Buy (placeholder)">Buy CRON8</a>
      </div>

      <div class="stats" role="status" aria-live="polite">
        <div class="stat"><div><small>Countries represented</small><span id="stat-countries">0</span></div></div>
        <div class="stat"><div><small>Citizens joined</small><span id="stat-citizens">0</span></div></div>
        <div class="stat"><div><small>Most active today</small><span id="stat-top">—</span></div></div>
      </div>
    </section>

    <section id="map-section" class="container grid">
      <div class="card">
        <div class="body">
          <h3>Community Map</h3>
          <p class="muted">Tap a country to join. You can also use the form below.</p>
          <div id="map" aria-label="Interactive world map"></div>
          <p class="map-note">Data is demo-only for now. Wallet connect + on-chain passport mint coming next.</p>
        </div>
      </div>

      <aside class="card" id="leaderboard-card">
        <div class="body">
          <h3>Leaderboard</h3>
          <table aria-describedby="leaderboard-desc">
            <caption id="leaderboard-desc" class="visually-hidden">Top countries by citizen count</caption>
            <thead><tr><th class="rank">#</th><th>Country</th><th class="count">Citizens</th></tr></thead>
            <tbody id="leaderboard"></tbody>
          </table>
        </div>
      </aside>

      <div class="card">
        <div class="body">
          <h3>Join CROnation</h3>
          <form id="join-form" class="grid" style="grid-template-columns:1fr 1fr;">
            <div class="field">
              <label for="country">Country</label>
              <select id="country" required>
                <option value="">Select your country</option>
              </select>
            </div>
            <div class="field">
              <label for="nickname">Nickname (optional)</label>
              <input id="nickname" placeholder="e.g. WillyBilly" />
            </div>
            <div class="field" style="grid-column:1 / -1;">
              <button class="btn primary" type="submit">Mint Passport (demo)</button>
            </div>
          </form>

          <div id="passport" class="passport" style="display:none;">
  <div class="emblem" aria-hidden="true">
    <img src="https://raw.githubusercontent.com/LandoCrissian/WorldCoin/refs/heads/main/8DAEE2BE-F14F-4EB2-A993-E8EFE1EC2E35.png" 
         alt="CROnation logo" style="width:64px;height:64px;object-fit:contain;border-radius:12px;" />
  </div>
  <div class="info">
    <b>CROnation Passport</b>
    <small id="passport-details">—</small>
  </div>
</div>

      <div class="card" id="about">
        <div class="body">
          <h3>About</h3>
          <p class="muted">CROnation is a simple, global participation map for the Cronos community. It’s not a complicated game or an overpromised utility — just a clean way to visualize where we all are, and a minimal passport NFT to flex your origin.</p>
          <p class="muted">Design language: premium, minimal, accessible. Built mobile-first with a lightweight stack and room to grow into wallet connections, airdrops, and seasonal leaderboards.</p>
        </div>
      </div>
    </section>

    <!-- Modal (used when clicking map) -->
    <div class="modal" id="join-modal" role="dialog" aria-modal="true" aria-labelledby="join-title">
      <div class="panel">
        <div class="header">
          <b id="join-title">Join CROnation</b>
          <button class="btn" onclick="closeModal()">Close</button>
        </div>
        <div class="content">
          <div class="field">
            <label for="modal-country">Country</label>
            <input id="modal-country" disabled>
          </div>
          <div class="field">
            <label for="modal-nickname">Nickname (optional)</label>
            <input id="modal-nickname" placeholder="e.g. HillBillyCRO">
          </div>
        </div>
        <div class="footer">
          <button class="btn primary" onclick="mintFromModal()">Mint Passport (demo)</button>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div style="display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap;">
        <small>© <span id="year"></span> CROnation. Built for Cronos — community-first.</small>
        <small class="muted">This platform is evolving — join us as we build CROnation together.</small>
      </div>
    </div>
  </footer>

  <script>
    const el = (id)=>document.getElementById(id);

    function scrollToMap(){
  const header = document.querySelector('header');
  const y = document.getElementById('map-section').getBoundingClientRect().top + window.pageYOffset - header.getBoundingClientRect().height - 8;
  window.scrollTo({ top: y, behavior:'smooth' });
}

   // Hamburger toggle
(function mobileMenu(){
  const btn = document.getElementById('hamburger');
  const menu = document.getElementById('mobile-menu');
  if(!btn || !menu) return;

  const close = () => { menu.classList.remove('open'); btn.setAttribute('aria-expanded','false'); };
  const open  = () => { menu.classList.add('open');  btn.setAttribute('aria-expanded','true'); };

  btn.addEventListener('click', () => {
    const expanded = btn.getAttribute('aria-expanded') === 'true';
    expanded ? close() : open();
  });

  // Close on link click / ESC / outside tap
  menu.querySelectorAll('a').forEach(a => a.addEventListener('click', close));
  window.addEventListener('keydown', e => { if(e.key === 'Escape') close(); }, { passive:true });
  window.addEventListener('click', e => {
    if(!menu.contains(e.target) && e.target !== btn && !btn.contains(e.target)) close();
  }, { passive:true });

  // Close on resize to desktop
  window.addEventListener('resize', () => { if(window.innerWidth > 640) close(); }, { passive:true });
})(); 

    // Smooth scroll with sticky-header offset for in-page links
(function attachSmoothAnchors() {
  const header = document.querySelector('header');
  const headerH = () => header.getBoundingClientRect().height;

  document.querySelectorAll('a.link[href^="#"]').forEach(a => {
    a.addEventListener('click', (e) => {
      e.preventDefault();
      const id = a.getAttribute('href').slice(1);
      const target = document.getElementById(id) || document.querySelector(`[name="${id}"]`);
      if (!target) return;
      const y = target.getBoundingClientRect().top + window.pageYOffset - headerH() - 8;
      window.scrollTo({ top: y, behavior: 'smooth' });
    });
  });

  // If the page loads with a hash, nudge into place
  if (location.hash) {
    setTimeout(() => {
      const id = location.hash.slice(1);
      const t = document.getElementById(id);
      if (t) {
        const y = t.getBoundingClientRect().top + window.pageYOffset - headerH() - 8;
        window.scrollTo({ top: y });
      }
    }, 0);
  }
})();

    // Stats + leaderboard state
    const countryCounts = new Map(); // country -> count
    const countryList = [];          // for dropdown
    let totalCitizens = 0;

    // Current year
    el('year').textContent = new Date().getFullYear();

    // Initialize Leaflet map (minimal look, no tiles)
    const map = L.map('map', {
      zoomControl: true,
      minZoom: 1,
      maxZoom: 6,
      worldCopyJump: true,
      attributionControl: false
    }).setView([20, 0], 2);

    // Load world countries GeoJSON
    const GEOJSON_URL = 'https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson';

    fetch(GEOJSON_URL)
      .then(r => r.json())
      .then(data => {
        const features = data.features;

        // Prepare country list
        features.forEach(f => {
          const name = f.properties.ADMIN || f.properties.name || f.properties.COUNTRY || 'Unknown';
          countryList.push(name);
        });
        countryList.sort((a,b)=>a.localeCompare(b));
        populateCountryDropdown(countryList);

        // Style + interactivity
        const layer = L.geoJSON(data, {
          style: feature => ({
            color: '#cbd5e1',   // stroke
            weight: 1,
            fillColor: '#e5e7eb',
            fillOpacity: 1
          }),
          onEachFeature: (feature, l) => {
            const name = feature.properties.ADMIN || feature.properties.name || feature.properties.COUNTRY || 'Unknown';
            l.on({
              mouseover: () => { l.setStyle({fillColor:'#dbeafe'}); },
              mouseout:  () => { l.setStyle({fillColor:'#e5e7eb'}); },
              click:     () => openModal(name)
            });
            l.bindTooltip(name, {sticky: true});
          }
        }).addTo(map);

        try { map.fitBounds(layer.getBounds(), {padding:[10,10]}); } catch(e){}

// iOS Safari sometimes needs a nudge after layout settles
requestAnimationFrame(() => map.invalidateSize());
setTimeout(() => map.invalidateSize(), 300);

// Keep it correct on rotate / resize
['orientationchange','resize'].forEach(ev =>
  window.addEventListener(ev, () => map.invalidateSize(), { passive: true })
);
})  // <-- closes the .then(data => { ... })
.catch(err => {
  console.error('Failed to load GeoJSON', err);
  el('map').innerHTML = '<div style="padding:16px;color:var(--muted)">Unable to load map right now.</div>';
});

    function populateCountryDropdown(list){
      const sel = el('country');
      const frag = document.createDocumentFragment();
      list.forEach(name => {
        const opt = document.createElement('option');
        opt.value = name; opt.textContent = name;
        frag.appendChild(opt);
      });
      sel.appendChild(frag);
    }

    // Modal handlers
    function openModal(country){
      const modal = el('join-modal');
      el('modal-country').value = country;
      el('modal-nickname').value = '';
      modal.setAttribute('open', '');
    }
    function closeModal(){
      el('join-modal').removeAttribute('open');
    }
    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

    function mintFromModal(){
      const country = el('modal-country').value;
      const nick = el('modal-nickname').value || 'Anonymous';
      performMint(country, nick);
      closeModal();
    }

    // Form join flow
    el('join-form').addEventListener('submit', (e)=>{
      e.preventDefault();
      const country = el('country').value;
      if(!country){ alert('Please select your country'); return; }
      const nick = el('nickname').value || 'Anonymous';
      performMint(country, nick);
    });

    function performMint(country, nick){
      // Update in-memory counts
      const prev = countryCounts.get(country) || 0;
      countryCounts.set(country, prev + 1);
      totalCitizens += 1;

      // Update UI: stats, leaderboard, passport preview
      renderStats();
      renderLeaderboard();
      showPassport(country, nick);

      // Reset form
      el('country').value = '';
      el('nickname').value = '';
    }

    function renderStats(){
      const countriesRepresented = countryCounts.size;
      el('stat-countries').textContent = countriesRepresented;
      el('stat-citizens').textContent  = totalCitizens;

      // Top country
      let top = '—', max = -1;
      countryCounts.forEach((count, name)=>{
        if(count > max){ max = count; top = name; }
      });
      el('stat-top').textContent = max > 0 ? `${top} (${max})` : '—';
    }

    function renderLeaderboard(){
      const arr = Array.from(countryCounts.entries()).sort((a,b)=> b[1]-a[1]).slice(0, 10);
      const tbody = el('leaderboard');
      tbody.innerHTML = '';
      arr.forEach(([name, count], i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="rank">${i+1}</td>
          <td class="country-name">${name}</td>
          <td class="count">${count}</td>
        `;
        tbody.appendChild(tr);
      });
      if(arr.length === 0){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="rank">—</td><td class="muted">No countries yet</td><td class="count">0</td>`;
        tbody.appendChild(tr);
      }
    }

    function showPassport(country, nick){
      const card = el('passport');
      const serial = Math.floor(Math.random()*999999).toString().padStart(6, '0');
      el('passport-details').textContent = `${nick} — ${country} • Passport #${serial}`;
      card.style.display = 'grid';
      card.scrollIntoView({behavior:'smooth', block:'center'});
    }

    // Initial leaderboard render
    renderLeaderboard();
  </script>
</body>
</html>
